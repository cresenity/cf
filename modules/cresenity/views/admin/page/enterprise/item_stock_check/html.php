<?php	$db = CDatabase::instance();	$org = CJDB::instance()->get("org",array("org_id"=>$org_id));	if($org->count()>0) {	$org_code = $org[0]->code;	}	?><?php	$q= "		SELECT n.item_id,n.cog_avg,o.cog_avg_after,n.name as item_name,o.date		FROM item n 		INNER JOIN (		  SELECT item_id,cog_avg_after, MAX(item_history_id) as max_id 		  FROM item_history GROUP BY item_id		) AS m on m.item_id=n.item_id		inner join item_history as o on o.item_history_id=m.max_id		where			n.org_id=".$db->escape($org_id)."			and n.cog_avg!=o.cog_avg_after	";			$table = CTable::factory('table_item_check');	$table->set_apply_data_table(false);	$table->set_data_from_query($q);	$table->set_key('item_id');	$table->add_column('item_name')->set_label('Item');	$table->add_column('cog_avg')->set_label('COG AVG on Table Item')->set_align('right')->add_transform('thousand_separator');	$table->add_column('cog_avg_after')->set_label('COG AVG After on last Table Item History')->set_align('right')->add_transform('thousand_separator');	$table->add_column('date')->set_label('Date Table Item History')->set_align('center');	echo $table->html();				?>